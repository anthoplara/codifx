<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>CODIFX - Stock Screening Dashboard</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .card-enter {
                animation: fadeIn 0.3s ease-out;
            }
            .modal-backdrop {
                backdrop-filter: blur(8px);
            }
        </style>
    </head>
    <body
        class="bg-gradient-to-br from-gray-50 via-blue-50 to-gray-100 min-h-screen text-gray-900"
    >
        <div class="container mx-auto px-4 py-8">
            <!-- Header -->
            <div class="mb-8">
                <h1
                    class="text-4xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent"
                >
                    CODIFX Stock Screening Dashboard
                </h1>
                <p class="text-gray-600">
                    Real-time technical analysis and trading signals -
                    {{SCAN_TIME}}
                </p>
            </div>

            <!-- Stats Bar -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div
                    class="bg-white rounded-xl p-4 shadow-md border border-green-200"
                >
                    <div class="text-green-600 text-sm mb-1 font-medium">
                        Total Signals
                    </div>
                    <div class="text-3xl font-bold text-gray-900">
                        {{TOTAL_SIGNALS}}
                    </div>
                </div>
                <div
                    class="bg-white rounded-xl p-4 shadow-md border border-blue-200"
                >
                    <div class="text-blue-600 text-sm mb-1 font-medium">
                        Buy Signals
                    </div>
                    <div class="text-3xl font-bold text-gray-900">
                        {{BUY_SIGNALS}}
                    </div>
                </div>
                <div
                    class="bg-white rounded-xl p-4 shadow-md border border-red-200"
                >
                    <div class="text-red-600 text-sm mb-1 font-medium">
                        Sell Signals
                    </div>
                    <div class="text-3xl font-bold text-gray-900">
                        {{SELL_SIGNALS}}
                    </div>
                </div>
                <div
                    class="bg-white rounded-xl p-4 shadow-md border border-purple-200"
                >
                    <div class="text-purple-600 text-sm mb-1 font-medium">
                        Avg Score
                    </div>
                    <div class="text-3xl font-bold text-gray-900">
                        {{AVG_SCORE}}
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div
                class="bg-white rounded-xl p-4 mb-6 shadow-md border border-gray-200"
            >
                <div class="flex flex-wrap gap-3">
                    <button
                        onclick="filterSignals('all')"
                        class="filter-btn active px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition font-medium"
                    >
                        All Signals
                    </button>
                    <button
                        onclick="filterSignals('buy')"
                        class="filter-btn px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 transition font-medium"
                    >
                        Buy Only
                    </button>
                    <button
                        onclick="filterSignals('sell')"
                        class="filter-btn px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 transition font-medium"
                    >
                        Sell Only
                    </button>
                    <button
                        onclick="filterSignals('strong')"
                        class="filter-btn px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 transition font-medium"
                    >
                        Strong Signals (‚â•80)
                    </button>
                </div>
            </div>

            <!-- Stock Cards Grid -->
            <div
                id="stockGrid"
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
            >
                <!-- Cards will be inserted here -->
            </div>
        </div>

        <!-- Chart Modal -->
        <div
            id="chartModal"
            class="hidden fixed inset-0 bg-black/50 modal-backdrop z-50 flex items-center justify-center p-4"
        >
            <div
                class="bg-white rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden shadow-2xl"
            >
                <div
                    class="flex justify-between items-center p-6 border-b border-gray-200"
                >
                    <h3
                        class="text-2xl font-bold text-gray-900"
                        id="chartTitle"
                    >
                        Chart
                    </h3>
                    <button
                        onclick="closeModal('chartModal')"
                        class="text-gray-400 hover:text-gray-600 transition text-3xl leading-none"
                    >
                        &times;
                    </button>
                </div>
                <div class="p-6">
                    <div
                        id="chartContainer"
                        class="w-full"
                        style="height: 600px"
                    >
                        <!-- TradingView Widget will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Analysis Modal -->
        <div
            id="aiModal"
            class="hidden fixed inset-0 bg-black/50 modal-backdrop z-50 flex items-center justify-center p-4"
        >
            <div
                class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden shadow-2xl"
            >
                <div
                    class="flex justify-between items-center p-6 border-b border-gray-200"
                >
                    <h3 class="text-2xl font-bold text-gray-900" id="aiTitle">
                        AI Analysis
                    </h3>
                    <button
                        onclick="closeModal('aiModal')"
                        class="text-gray-400 hover:text-gray-600 transition text-3xl leading-none"
                    >
                        &times;
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                    <div id="aiContent" class="space-y-4">
                        <!-- AI analysis will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Data from CODIFX scan
            const stockData = {{STOCK_DATA}};

            let currentFilter = 'all';

            function renderStockCards(data) {
                const grid = document.getElementById('stockGrid');
                grid.innerHTML = '';

                const filteredData = data.filter(stock => {
                    if (currentFilter === 'all') return true;
                    if (currentFilter === 'buy') return stock.direction === 'BUY';
                    if (currentFilter === 'sell') return stock.direction === 'SELL';
                    if (currentFilter === 'strong') return stock.finalScore >= 80;
                    return true;
                });

                filteredData.forEach((stock, index) => {
                    const directionColor = stock.direction === 'BUY' ? 'green' : 'red';
                    const directionBg = stock.direction === 'BUY' ? 'bg-green-50' : 'bg-red-50';
                    const directionBorder = stock.direction === 'BUY' ? 'border-green-200' : 'border-red-200';

                    const card = document.createElement('div');
                    card.className = `card-enter bg-white ${directionBg} rounded-xl p-6 border-2 ${directionBorder} shadow-lg hover:shadow-xl transition transform hover:-translate-y-1`;
                    card.style.animationDelay = `${index * 0.1}s`;

                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-2xl font-bold text-gray-900 mb-1">${stock.symbol}</h3>
                                <span class="text-${directionColor}-600 text-sm font-bold">${stock.direction}</span>
                            </div>
                            <div class="text-right">
                                <div class="text-3xl font-bold text-gray-900">${stock.finalScore}</div>
                                <div class="text-xs text-gray-500">/ 100</div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <span class="inline-block px-3 py-1 rounded-full text-xs font-bold ${
                                stock.rating.includes('STRONG') ? 'bg-green-100 text-green-700 border border-green-300' :
                                stock.rating === 'BUY' || stock.rating === 'SELL' ? 'bg-blue-100 text-blue-700 border border-blue-300' :
                                'bg-yellow-100 text-yellow-700 border border-yellow-300'
                            }">
                                ${stock.rating}
                            </span>
                        </div>

                        <div class="space-y-3 mb-4">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 font-medium">Trend</span>
                                <span class="font-bold text-gray-900">${stock.breakdown.trend}/100</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full" style="width: ${stock.breakdown.trend}%"></div>
                            </div>

                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 font-medium">Oscillator</span>
                                <span class="font-bold text-gray-900">${stock.breakdown.oscillator}/100</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-purple-500 to-purple-600 h-2 rounded-full" style="width: ${stock.breakdown.oscillator}%"></div>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-3 mb-4 text-sm space-y-1 border border-gray-200">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Volume Bonus</span>
                                <span class="text-${stock.breakdown.volumeBonus > 0 ? 'green' : 'gray'}-600 font-semibold">+${stock.breakdown.volumeBonus}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Volatility Bonus</span>
                                <span class="text-${stock.breakdown.volatilityBonus > 0 ? 'green' : 'gray'}-600 font-semibold">+${stock.breakdown.volatilityBonus}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Confirmation Bonus</span>
                                <span class="text-${stock.breakdown.confirmationBonus > 0 ? 'green' : 'gray'}-600 font-semibold">+${stock.breakdown.confirmationBonus}</span>
                            </div>
                        </div>

                        <div class="flex gap-2">
                            <button onclick="openChart('${stock.symbol}')" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition shadow-md">
                                üìä Chart
                            </button>
                            <button onclick="openAI('${stock.symbol}')" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition shadow-md">
                                ü§ñ AI
                            </button>
                        </div>
                    `;

                    grid.appendChild(card);
                });
            }

            function filterSignals(filter) {
                currentFilter = filter;
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active', 'bg-blue-600', 'text-white');
                    btn.classList.add('bg-gray-100', 'text-gray-700');
                });
                event.target.classList.remove('bg-gray-100', 'text-gray-700');
                event.target.classList.add('active', 'bg-blue-600', 'text-white');
                renderStockCards(stockData);
            }

            function convertToTradingViewSymbol(symbol) {
                // Convert .JK (Indonesia) to IDX:SYMBOL format
                if (symbol.endsWith('.JK')) {
                    const baseSymbol = symbol.replace('.JK', '');
                    return `IDX:${baseSymbol}`;
                }
                // Add other market conversions if needed
                return symbol;
            }

            function openChart(symbol) {
                document.getElementById('chartTitle').textContent = `${symbol} - Chart`;

                const container = document.getElementById('chartContainer');
                container.innerHTML = '';

                // Convert symbol to TradingView format
                const tvSymbol = convertToTradingViewSymbol(symbol);

                const iframe = document.createElement('iframe');
                iframe.style.width = '100%';
                iframe.style.height = '600px';
                iframe.style.border = 'none';
                iframe.src = `https://www.tradingview.com/widgetembed/?frameElementId=tradingview_chart&symbol=${encodeURIComponent(tvSymbol)}&interval=D&hidesidetoolbar=0&symboledit=1&saveimage=0&toolbarbg=f1f3f6&studies=[]&theme=light&style=1&timezone=Asia%2FJakarta&locale=id`;

                container.appendChild(iframe);
                document.getElementById('chartModal').classList.remove('hidden');
            }

            function openAI(symbol) {
                // Find stock by symbol from original stockData
                const stock = stockData.find(s => s.symbol === symbol);
                if (!stock) return;

                document.getElementById('aiTitle').textContent = `${stock.symbol} - AI Analysis`;

                document.getElementById('aiContent').innerHTML = `
                    <div class="bg-blue-50 rounded-lg p-4 mb-4 border border-blue-200">
                        <h4 class="font-bold text-lg mb-2 text-blue-700">üìä Technical Summary</h4>
                        <p class="text-gray-700">Signal: <span class="font-bold text-${stock.direction === 'BUY' ? 'green' : 'red'}-600">${stock.direction}</span></p>
                        <p class="text-gray-700">Rating: <span class="font-bold">${stock.rating}</span></p>
                        <p class="text-gray-700">Final Score: <span class="font-bold">${stock.finalScore}/100</span></p>
                        <p class="text-gray-700 mt-2">Win Rate: <span class="font-bold text-green-600">${stock.winRate}%</span></p>
                    </div>

                    <div class="bg-purple-50 rounded-lg p-4 mb-4 border border-purple-200">
                        <h4 class="font-bold text-lg mb-2 text-purple-700">üîç Trend Analysis</h4>
                        <ul class="space-y-1 text-sm">
                            ${stock.trendDetails.map(detail => `<li class="text-gray-700">‚Ä¢ ${detail}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="bg-green-50 rounded-lg p-4 mb-4 border border-green-200">
                        <h4 class="font-bold text-lg mb-2 text-green-700">üìà Oscillator Signals</h4>
                        <ul class="space-y-1 text-sm">
                            ${stock.oscillatorDetails.map(detail => `<li class="text-gray-700">${detail}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="bg-orange-50 rounded-lg p-4 mb-4 border border-orange-200">
                        <h4 class="font-bold text-lg mb-2 text-orange-700">üí∞ Trading Levels</h4>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div>
                                <span class="text-gray-600">Entry:</span>
                                <span class="font-bold text-gray-800">Rp ${Math.round(stock.entry).toLocaleString('id-ID')}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Stop Loss:</span>
                                <span class="font-bold text-red-600">Rp ${Math.round(stock.stopLoss).toLocaleString('id-ID')}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Take Profit:</span>
                                <span class="font-bold text-green-600">Rp ${Math.round(stock.takeProfit).toLocaleString('id-ID')}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Risk/Reward:</span>
                                <span class="font-bold text-blue-600">1:${stock.riskRewardRatio}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Support:</span>
                                <span class="font-bold text-gray-800">Rp ${Math.round(stock.support).toLocaleString('id-ID')}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Resistance:</span>
                                <span class="font-bold text-gray-800">Rp ${Math.round(stock.resistance).toLocaleString('id-ID')}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-200">
                        <h4 class="font-bold text-lg mb-2 text-yellow-700">‚úÖ Filter Status</h4>
                        <p class="text-gray-700">Liquidity: <span class="font-bold text-green-600">${stock.filters.liquidity ? 'PASS' : 'FAIL'}</span></p>
                        <p class="text-gray-700">Volatility: <span class="font-bold text-green-600">${stock.filters.volatility ? 'PASS' : 'FAIL'}</span></p>
                    </div>

                    <div class="mt-4 p-4 bg-blue-50 border-2 border-blue-300 rounded-lg">
                        <p class="text-sm text-gray-700">
                            üí° <strong>Recommendation:</strong> ${
                                stock.direction === 'BUY'
                                ? `Consider entering at Rp ${Math.round(stock.entry).toLocaleString('id-ID')} with stop loss at Rp ${Math.round(stock.stopLoss).toLocaleString('id-ID')} and take profit at Rp ${Math.round(stock.takeProfit).toLocaleString('id-ID')}.`
                                : `Consider short entry at Rp ${Math.round(stock.entry).toLocaleString('id-ID')} with stop loss at Rp ${Math.round(stock.stopLoss).toLocaleString('id-ID')} and take profit at Rp ${Math.round(stock.takeProfit).toLocaleString('id-ID')}.`
                            }
                        </p>
                    </div>
                `;

                document.getElementById('aiModal').classList.remove('hidden');
            }

            function closeModal(modalId) {
                document.getElementById(modalId).classList.add('hidden');
            }

            // Close modal when clicking outside
            document.getElementById('chartModal').addEventListener('click', function(e) {
                if (e.target === this) closeModal('chartModal');
            });

            document.getElementById('aiModal').addEventListener('click', function(e) {
                if (e.target === this) closeModal('aiModal');
            });

            // Initialize dashboard
            renderStockCards(stockData);
        </script>
    </body>
</html>
